# Readdy Editor ç³»ç»Ÿå¤ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨å…¶ä»–é¡¹ç›®ä¸­å¤ç”¨ Readdy Editor çš„æ ¸å¿ƒç³»ç»Ÿï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€AIè°ƒç”¨ç³»ç»Ÿå’Œæ‹–æ‹½åŠŸèƒ½ã€‚è¿™äº›æ¨¡å—ç»è¿‡å……åˆ†æµ‹è¯•ï¼Œå…·æœ‰è‰¯å¥½çš„å¯å¤ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒæ¨¡å—
```
readdy-editor/
â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿæ¨¡å—
â”‚   â”œâ”€â”€ services/file-system.ts      # æ ¸å¿ƒæ–‡ä»¶ç³»ç»ŸæœåŠ¡
â”‚   â”œâ”€â”€ services/storage.ts          # IndexedDBå­˜å‚¨æœåŠ¡
â”‚   â”œâ”€â”€ components/FileTree/          # æ–‡ä»¶æ ‘UIç»„ä»¶
â”‚   â””â”€â”€ services/drag-drop.ts        # æ‹–æ‹½åŠŸèƒ½æœåŠ¡
â”œâ”€â”€ AIè°ƒç”¨æ¨¡å—
â”‚   â”œâ”€â”€ services/ai/                 # AIæœåŠ¡æŠ½è±¡å±‚
â”‚   â”œâ”€â”€ components/AI/ChatPanel.vue  # AIå¯¹è¯ç•Œé¢
â”‚   â””â”€â”€ types/ai.ts                  # AIç›¸å…³ç±»å‹å®šä¹‰
â””â”€â”€ é€šç”¨æ¨¡å—
    â”œâ”€â”€ types/index.ts               # æ ¸å¿ƒç±»å‹å®šä¹‰
    â””â”€â”€ utils/                       # å·¥å…·å‡½æ•°
```

## ğŸ—‚ï¸ æ–‡ä»¶ç³»ç»Ÿæ¨¡å—å¤ç”¨

### æ ¸å¿ƒç»„ä»¶

#### 1. FileSystemService (`services/file-system.ts`)
**åŠŸèƒ½**ï¼šå®Œæ•´çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒæ–‡ä»¶/æ–‡ä»¶å¤¹çš„CRUDæ“ä½œã€æ‹–æ‹½æ’åº

**å¤ç”¨æ–¹æ³•**ï¼š
```typescript
// 1. å¤åˆ¶æ–‡ä»¶ç³»ç»ŸæœåŠ¡
import { FileSystemService } from './services/file-system'
import type { FileEntry, Project } from './types'

// 2. åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿå®ä¾‹
const fileSystem = new FileSystemService()

// 3. åŸºç¡€æ“ä½œ
await fileSystem.createProject({ name: 'æ–°é¡¹ç›®', description: 'é¡¹ç›®æè¿°' })
await fileSystem.createFile('æ–‡æ¡£.md', undefined, '# æ ‡é¢˜')
await fileSystem.createFolder('æ–‡ä»¶å¤¹')
await fileSystem.moveFile(fileId, newParentId, 'after', targetFileId)
```

**ä¾èµ–è¦æ±‚**ï¼š
```json
{
  "vue": "^3.5.0",
  "dexie": "^4.0.0"
}
```

#### 2. StorageService (`services/storage.ts`)
**åŠŸèƒ½**ï¼šåŸºäºIndexedDBçš„æŒä¹…åŒ–å­˜å‚¨æœåŠ¡

**å¤ç”¨æ–¹æ³•**ï¼š
```typescript
import { storageService } from './services/storage'

// é¡¹ç›®æ“ä½œ
const projects = await storageService.getProjects()
const projectId = await storageService.createProject(projectData)

// æ–‡ä»¶æ“ä½œ
const fileId = await storageService.saveFile(projectId, fileData)
await storageService.updateFile(projectId, fileId, updates)
await storageService.deleteFile(projectId, fileId)
```

#### 3. FileTreeç»„ä»¶ (`components/FileTree/`)
**åŠŸèƒ½**ï¼šå¯æ‹–æ‹½çš„æ–‡ä»¶æ ‘UIç»„ä»¶ï¼Œæ”¯æŒé‡å‘½åã€åˆ é™¤ã€æ’åº

**å¤ç”¨æ–¹æ³•**ï¼š
```vue
<template>
  <FileTree
    :files="files"
    :active-file-id="activeFileId"
    @file-select="handleFileSelect"
    @folder-select="handleFolderSelect"
    @file-delete="handleFileDelete"
    @file-rename="handleFileRename"
    @file-move="handleFileMove"
  />
</template>

<script setup>
import FileTree from './components/FileTree/FileTree.vue'

const handleFileMove = async (data) => {
  await fileSystem.moveFile(
    data.fileId, 
    data.targetParentId, 
    data.position, 
    data.targetFileId
  )
}
</script>
```

### æ‹–æ‹½åŠŸèƒ½å¤ç”¨

#### DragDropService (`services/drag-drop.ts`)
**åŠŸèƒ½**ï¼šæ™ºèƒ½æ‹–æ‹½æœåŠ¡ï¼Œæ”¯æŒæ–‡ä»¶å¤¹ç§»å…¥å’Œé¡ºåºè°ƒæ•´

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- æ™ºèƒ½åŒºåŸŸæ£€æµ‹ï¼ˆä¸Šä¸­ä¸‹ä¸‰åŒºåŸŸï¼‰
- è§†è§‰åé¦ˆæŒ‡ç¤ºå™¨
- é˜²å¾ªç¯å¼•ç”¨æ£€æŸ¥
- Vueå“åº”å¼å…¼å®¹

**å¤ç”¨ç¤ºä¾‹**ï¼š
```typescript
import { dragDropService } from './services/drag-drop'

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const handleDragStart = (event: DragEvent) => {
  const dragData = {
    type: 'file',
    id: file.id,
    name: file.name,
    parentId: file.parentId
  }
  dragDropService.startDrag(dragData, element)
}

const handleDragOver = (event: DragEvent) => {
  const target = { type: 'folder', id: folder.id, name: folder.name }
  const canDrop = dragDropService.handleDragOver(event, target, element)
  event.dataTransfer!.dropEffect = canDrop ? 'move' : 'none'
}
```

## ğŸ¤– AIè°ƒç”¨ç³»ç»Ÿå¤ç”¨

### æ ¸å¿ƒç»„ä»¶

#### 1. AIæœåŠ¡æŠ½è±¡å±‚ (`services/ai/`)
**åŠŸèƒ½**ï¼šç»Ÿä¸€çš„AIæœåŠ¡æ¥å£ï¼Œæ”¯æŒå¤šç§AIæ¨¡å‹

**ç›®å½•ç»“æ„**ï¼š
```
services/ai/
â”œâ”€â”€ base.ts              # AIæœåŠ¡åŸºç±»
â”œâ”€â”€ gemini.ts            # Google Geminiå®ç°
â”œâ”€â”€ openai.ts            # OpenAIå®ç°
â”œâ”€â”€ claude.ts            # Anthropic Claudeå®ç°
â””â”€â”€ index.ts             # ç»Ÿä¸€å¯¼å‡º
```

**å¤ç”¨æ–¹æ³•**ï¼š
```typescript
// 1. å¯¼å…¥AIæœåŠ¡
import { AIServiceFactory, type AIConfig } from './services/ai'

// 2. é…ç½®AIæœåŠ¡
const config: AIConfig = {
  provider: 'gemini',
  apiKey: 'your-api-key',
  model: 'gemini-2.5-flash-lite-preview-06-17'
}

// 3. åˆ›å»ºæœåŠ¡å®ä¾‹
const aiService = AIServiceFactory.create(config.provider, config)

// 4. è°ƒç”¨AI
const response = await aiService.chat([
  { role: 'user', content: 'ä½ å¥½' }
])

// 5. æµå¼è°ƒç”¨
await aiService.streamChat(
  [{ role: 'user', content: 'å†™ä¸€ç¯‡æ–‡ç« ' }],
  (chunk) => {
    console.log('æ”¶åˆ°æ•°æ®å—:', chunk.content)
  }
)
```

#### 2. ChatPanelç»„ä»¶ (`components/AI/ChatPanel.vue`)
**åŠŸèƒ½**ï¼šå®Œæ•´çš„AIå¯¹è¯ç•Œé¢ï¼Œæ”¯æŒæµå¼æ˜¾ç¤ºå’Œç¼–è¾‘å™¨é›†æˆ

**å¤ç”¨æ–¹æ³•**ï¼š
```vue
<template>
  <ChatPanel 
    :editor-ref="editorRef"
    @message-sent="handleMessageSent"
  />
</template>

<script setup>
import ChatPanel from './components/AI/ChatPanel.vue'

// éœ€è¦ä¼ å…¥Monaco Editorå®ä¾‹
const editorRef = monaco.editor.create(container, options)
</script>
```

#### 3. ç¼–è¾‘å™¨é›†æˆåŠŸèƒ½
**åŠŸèƒ½**ï¼šAIå›å¤ç›´æ¥æ’å…¥ç¼–è¾‘å™¨ã€å†…å®¹åˆ†æã€æ™ºèƒ½æ“ä½œ

**é›†æˆæ–¹æ³•**ï¼š
```typescript
// AIæ“ä½œç¤ºä¾‹
const aiOperations = {
  // æ’å…¥åˆ°å…‰æ ‡ä½ç½®
  insertToEditor: (content: string) => {
    const position = editor.getPosition()
    editor.executeEdits('insert-ai-content', [{
      range: new monaco.Range(
        position.lineNumber, position.column,
        position.lineNumber, position.column
      ),
      text: content
    }])
  },

  // æ›¿æ¢å…¨éƒ¨å†…å®¹
  replaceContent: (content: string) => {
    editor.setValue(content)
  },

  // è·å–é€‰ä¸­æ–‡æœ¬
  getSelectedText: () => {
    const selection = editor.getSelection()
    const model = editor.getModel()
    return model.getValueInRange(selection)
  }
}
```

## ğŸ“¦ å®Œæ•´é›†æˆæ­¥éª¤

### æ­¥éª¤1ï¼šå®‰è£…ä¾èµ–
```bash
npm install vue@^3.5.0 dexie@^4.0.0 monaco-editor@^0.52.0
```

### æ­¥éª¤2ï¼šå¤åˆ¶æ ¸å¿ƒæ–‡ä»¶
```bash
# æ–‡ä»¶ç³»ç»Ÿæ¨¡å—
cp -r src/services/file-system.ts your-project/src/services/
cp -r src/services/storage.ts your-project/src/services/
cp -r src/services/drag-drop.ts your-project/src/services/
cp -r src/components/FileTree/ your-project/src/components/

# AIç³»ç»Ÿæ¨¡å—
cp -r src/services/ai/ your-project/src/services/
cp -r src/components/AI/ your-project/src/components/

# ç±»å‹å®šä¹‰
cp -r src/types/ your-project/src/
```

### æ­¥éª¤3ï¼šé…ç½®ç¯å¢ƒ
```typescript
// main.ts
import { createApp } from 'vue'
import { storageService } from './services/storage'

const app = createApp(App)

// åˆå§‹åŒ–å­˜å‚¨æœåŠ¡
storageService.init()

app.mount('#app')
```

### æ­¥éª¤4ï¼šåˆ›å»ºåŸºç¡€å¸ƒå±€
```vue
<template>
  <div class="app-container">
    <!-- å·¦ä¾§æ–‡ä»¶æ ‘ -->
    <div class="sidebar">
      <FileTree
        :files="files"
        :active-file-id="activeFileId"
        @file-select="handleFileSelect"
        @file-move="handleFileMove"
      />
    </div>

    <!-- ä¸­é—´ç¼–è¾‘å™¨ -->
    <div class="editor-area">
      <div ref="editorContainer" class="editor-container"></div>
    </div>

    <!-- å³ä¾§AIé¢æ¿ -->
    <div class="ai-panel">
      <ChatPanel :editor-ref="editorRef" />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import * as monaco from 'monaco-editor'
import { fileSystem } from './services/file-system'
import FileTree from './components/FileTree/FileTree.vue'
import ChatPanel from './components/AI/ChatPanel.vue'

const editorContainer = ref<HTMLElement>()
const editorRef = ref<monaco.editor.IStandaloneCodeEditor>()
const files = computed(() => fileSystem.allFiles)
const activeFileId = ref<string>()

onMounted(async () => {
  // åˆå§‹åŒ–Monaco Editor
  editorRef.value = monaco.editor.create(editorContainer.value!, {
    value: '',
    language: 'markdown',
    theme: 'vs'
  })

  // åŠ è½½é¡¹ç›®
  await fileSystem.loadProject('default-project')
})

const handleFileSelect = async (fileId: string) => {
  activeFileId.value = fileId
  const result = await fileSystem.openFile(fileId)
  if (result.success && result.data) {
    editorRef.value?.setValue(result.data.content)
  }
}

const handleFileMove = async (data: any) => {
  await fileSystem.moveFile(
    data.fileId, 
    data.targetParentId, 
    data.position, 
    data.targetFileId
  )
}
</script>
```

## âš™ï¸ è‡ªå®šä¹‰é…ç½®

### æ–‡ä»¶ç³»ç»Ÿè‡ªå®šä¹‰

#### æ‰©å±•æ–‡ä»¶ç±»å‹
```typescript
// æ‰©å±•FileEntryæ¥å£
interface CustomFileEntry extends FileEntry {
  tags?: string[]           // æ–‡ä»¶æ ‡ç­¾
  category?: string         // æ–‡ä»¶åˆ†ç±»
  lastOpenedAt?: Date       // æœ€åæ‰“å¼€æ—¶é—´
  bookmarked?: boolean      // æ˜¯å¦æ”¶è—
}

// æ‰©å±•FileSystemService
class CustomFileSystemService extends FileSystemService {
  async addTag(fileId: string, tag: string) {
    // è‡ªå®šä¹‰æ ‡ç­¾åŠŸèƒ½
  }

  async searchByTag(tag: string) {
    // æŒ‰æ ‡ç­¾æœç´¢
  }
}
```

#### è‡ªå®šä¹‰å­˜å‚¨åç«¯
```typescript
// æ›¿æ¢IndexedDBä¸ºå…¶ä»–å­˜å‚¨æ–¹æ¡ˆ
class CloudStorageService implements StorageInterface {
  async saveFile(projectId: string, file: FileEntry): Promise<string> {
    // äº‘ç«¯å­˜å‚¨å®ç°
  }

  async getFile(projectId: string, fileId: string): Promise<FileEntry | null> {
    // äº‘ç«¯è·å–å®ç°
  }
}
```

### AIç³»ç»Ÿè‡ªå®šä¹‰

#### æ·»åŠ æ–°çš„AIæä¾›å•†
```typescript
// services/ai/custom-ai.ts
import { AIServiceBase } from './base'

export class CustomAIService extends AIServiceBase {
  constructor(config: AIConfig) {
    super(config)
  }

  async chat(messages: ChatMessage[]): Promise<string> {
    // è‡ªå®šä¹‰AIæœåŠ¡å®ç°
  }

  async streamChat(
    messages: ChatMessage[], 
    onChunk: (chunk: StreamChunk) => void
  ): Promise<void> {
    // è‡ªå®šä¹‰æµå¼å®ç°
  }
}

// æ³¨å†Œåˆ°å·¥å‚
AIServiceFactory.register('custom', CustomAIService)
```

#### è‡ªå®šä¹‰AIæ“ä½œ
```typescript
// æ‰©å±•AIæ“ä½œæŒ‰é’®
const customOperations = [
  {
    name: 'ä»£ç é‡æ„',
    icon: 'ri-code-line',
    prompt: 'è¯·é‡æ„ä»¥ä¸‹ä»£ç ï¼Œæé«˜å¯è¯»æ€§å’Œæ€§èƒ½ï¼š\n\n',
    context: 'code'
  },
  {
    name: 'ç¿»è¯‘æˆè‹±æ–‡',
    icon: 'ri-translate-line', 
    prompt: 'è¯·å°†ä»¥ä¸‹ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼š\n\n',
    context: 'text'
  }
]
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¤§æ–‡ä»¶å¤„ç†
```typescript
// ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æ–‡ä»¶
import { VirtualList } from '@tanstack/vue-virtual'

// æ–‡ä»¶å†…å®¹æ‡’åŠ è½½
const getFileContent = useMemoize(async (fileId: string) => {
  return await fileSystem.openFile(fileId)
})
```

### 2. AIè°ƒç”¨ä¼˜åŒ–
```typescript
// è¯·æ±‚å»é‡
const debounceAICall = debounce(async (prompt: string) => {
  return await aiService.chat([{ role: 'user', content: prompt }])
}, 1000)

// å“åº”ç¼“å­˜
const aiCache = new Map<string, string>()
```

### 3. æ‹–æ‹½æ€§èƒ½ä¼˜åŒ–
```typescript
// ä½¿ç”¨requestAnimationFrameä¼˜åŒ–æ‹–æ‹½åŠ¨ç”»
const updateDragPosition = (x: number, y: number) => {
  requestAnimationFrame(() => {
    dragElement.style.transform = `translate(${x}px, ${y}px)`
  })
}
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†
```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
try {
  const result = await fileSystem.createFile(name, parentId, content)
  if (!result.success) {
    throw new Error(result.error)
  }
} catch (error) {
  console.error('æ–‡ä»¶åˆ›å»ºå¤±è´¥:', error)
  // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
  showNotification('æ–‡ä»¶åˆ›å»ºå¤±è´¥ï¼Œè¯·é‡è¯•', 'error')
}
```

### 2. çŠ¶æ€ç®¡ç†
```typescript
// ä½¿ç”¨Piniaç®¡ç†å…¨å±€çŠ¶æ€
import { defineStore } from 'pinia'

export const useFileStore = defineStore('files', () => {
  const files = ref<FileEntry[]>([])
  const activeFile = ref<FileEntry | null>(null)
  
  const openFile = async (fileId: string) => {
    const result = await fileSystem.openFile(fileId)
    if (result.success) {
      activeFile.value = result.data
    }
  }

  return { files, activeFile, openFile }
})
```

### 3. ç±»å‹å®‰å…¨
```typescript
// ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
type FileOperation = 'create' | 'update' | 'delete' | 'move'

interface FileOperationResult<T = any> {
  success: boolean
  data?: T
  error?: string
  operation: FileOperation
}
```

## ğŸš€ éƒ¨ç½²å»ºè®®

### 1. ç”Ÿäº§ç¯å¢ƒé…ç½®
```typescript
// ç¯å¢ƒå˜é‡é…ç½®
const config = {
  storage: {
    dbName: process.env.VITE_DB_NAME || 'readdy-editor',
    version: 1
  },
  ai: {
    defaultProvider: process.env.VITE_DEFAULT_AI_PROVIDER || 'gemini',
    apiEndpoint: process.env.VITE_AI_API_ENDPOINT
  }
}
```

### 2. æ‰“åŒ…ä¼˜åŒ–
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'file-system': ['./src/services/file-system.ts'],
          'ai-services': ['./src/services/ai/index.ts'],
          'monaco-editor': ['monaco-editor']
        }
      }
    }
  }
})
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜

#### Q: å¦‚ä½•è¿ç§»ç°æœ‰é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼Ÿ
A: å®ç°æ•°æ®è¿ç§»è„šæœ¬ï¼š
```typescript
const migrateFromOldFormat = async (oldData: OldFileFormat[]) => {
  for (const oldFile of oldData) {
    await fileSystem.createFile(
      oldFile.name,
      oldFile.folderId,
      oldFile.content
    )
  }
}
```

#### Q: å¦‚ä½•æ‰©å±•æ”¯æŒæ›´å¤šæ–‡ä»¶ç±»å‹ï¼Ÿ
A: åœ¨æ–‡ä»¶å›¾æ ‡å’Œè¯­æ³•é«˜äº®ä¸­æ·»åŠ æ–°ç±»å‹ï¼š
```typescript
const getFileIcon = (file: FileEntry) => {
  const ext = file.name.split('.').pop()?.toLowerCase()
  const iconMap = {
    'md': 'ri-markdown-fill',
    'js': 'ri-javascript-fill',
    'py': 'ri-code-s-slash-fill',  // æ–°å¢Pythonæ”¯æŒ
    'go': 'ri-terminal-box-fill'   // æ–°å¢Goæ”¯æŒ
  }
  return iconMap[ext] || 'ri-file-text-line'
}
```

### è”ç³»æ–¹å¼
- **æŠ€æœ¯æ–‡æ¡£**: å‚è€ƒ `log.md` ä¸­çš„è¯¦ç»†å®ç°
- **é—®é¢˜åé¦ˆ**: é€šè¿‡é¡¹ç›®Issueæäº¤
- **åŠŸèƒ½å»ºè®®**: æ¬¢è¿æäº¤Pull Request

---

**æœ€åæ›´æ–°**: 2025-07-03  
**é€‚ç”¨ç‰ˆæœ¬**: Readdy Editor v1.0.0  
**ç»´æŠ¤è€…**: Claude (Anthropic)